<?php
/**
 * @var \Clearpay\Clearpay\Block\Product\Simulator $block
 */
if ($block->isEnabled()==1) {
    if ($block->checkCategory()!==true) {
        ?>
        <script>console.log("<?php echo $block->checkCategory();?>");</script>
        <?
    } else {
        ?>
        <script
                src="https://js.sandbox.afterpay.com/afterpay-1.x.js"
                data-min="<?php echo $block->getMinAmount(); ?>"
                data-max="<?php echo $block->getMaxAmount(); ?>"
                async
                defer
        ></script>
        <div class="mainSimulator">
            <afterpay-placement
                    id="cp_placement"
                    data-locale="<?php echo $block->getLocale(); ?>"
                    data-currency="<?php echo $block->getCurrency(); ?>"
                    data-amount="<?php echo $block->getAmount(); ?>"
                <?php if($block->isVariablePrice() === true) { ?>
                    data-amount="<?php echo $block->getAmount(); ?>"
                <?php } elseif($block->isRangePrice() === true) { ?>
                    data-amount="<?php echo $block->getMinimalPrice(); ?>"
                <?php } else { ?>
                    data-amount="<?php echo $block->getAmount(); ?>"
                <?php } ?>
            ></afterpay-placement>

            <?php if($block->isVariablePrice() === true) { ?>
                <script type="text/javascript">
                require(['jquery'], function ($)
                {
                    $(document).ready(function(){
                        $("<?php echo $block->getOnclickSelector(); ?>").on('change', function(){
                            var currentPrice = document.querySelector("<?php echo $block->getAmountSelector(); ?>").innerText;
                            currentPrice = currentPrice.replace('â‚¬', '').replace(',','.');
                            document.getElementById('cp_placement').setAttribute('data-amount', currentPrice);
                        });
                    });

                });
                </script>
            <?php }  ?>
        </div>
        <?php
        }
}

